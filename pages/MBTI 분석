import streamlit as st
import pandas as pd
import plotly.express as px

# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
df = pd.read_csv("countriesMBTI_16types.csv")

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="MBTI Distribution by Country", page_icon="ğŸŒ", layout="centered")

st.title("ğŸŒ êµ­ê°€ë³„ MBTI ë¶„í¬ ì‹œê°í™”")
st.markdown("**êµ­ê°€ë¥¼ ì„ íƒí•˜ë©´ ê·¸ ë‚˜ë¼ì˜ MBTI ìœ í˜•ë³„ ë¹„ìœ¨ì„ ë³¼ ìˆ˜ ìˆì–´ìš”!**")

# êµ­ê°€ ì„ íƒ
country = st.selectbox("ë‚˜ë¼ë¥¼ ì„ íƒí•˜ì„¸ìš” ğŸŒ", df["Country"].unique())

# ì„ íƒí•œ ë‚˜ë¼ì˜ ë°ì´í„° í•„í„°ë§
selected = df[df["Country"] == country].iloc[0, 1:]  # ì²« ë²ˆì§¸ í–‰, MBTI ë°ì´í„°ë§Œ ì¶”ì¶œ
mbti_data = pd.DataFrame({
    "MBTI": selected.index,
    "ë¹„ìœ¨(%)": selected.values * 100
}).sort_values(by="ë¹„ìœ¨(%)", ascending=False)

# ìƒ‰ìƒ ì„¤ì • (1ë“±ì€ íŒŒìŠ¤í…” í•‘í¬, ë‚˜ë¨¸ì§€ëŠ” ì ì  ì˜…ì€ íŒŒìŠ¤í…” ê·¸ë¼ë°ì´ì…˜)
base_color = px.colors.sequential.Pastel
colors = [base_color[i % len(base_color)] for i in range(len(mbti_data))]
colors[0] = "#ffb6c1"  # 1ë“± íŒŒìŠ¤í…” í•‘í¬

# ê·¸ë˜í”„ ìƒì„±
fig = px.bar(
    mbti_data,
    x="MBTI",
    y="ë¹„ìœ¨(%)",
    text=mbti_data["ë¹„ìœ¨(%)"].map("{:.2f}%".format),
    color="MBTI",
    color_discrete_sequence=colors
)

fig.update_traces(textposition="outside")
fig.update_layout(
    showlegend=False,
    yaxis_title="ë¹„ìœ¨(%)",
    xaxis_title="MBTI ìœ í˜•",
    title=f"{country}ì˜ MBTI ë¶„í¬",
    template="plotly_white",
    plot_bgcolor="rgba(0,0,0,0)"
)

st.plotly_chart(fig, use_container_width=True)
st.caption("ë°ì´í„° ì¶œì²˜: countriesMBTI_16types.csv")
